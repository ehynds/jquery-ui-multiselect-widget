/* jshint forin:true, noarg:true, noempty:true, eqeqeq:true, boss:true, undef:true, curly:true, browser:true, jquery:true */
/*
 * jQuery MultiSelect UI Widget 2.0.1
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.11 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
!function(e){var t=0,i=e(document);e.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",showCheckAll:!0,showUncheckAll:!0,selectedText:"# selected",selectedList:0,closeIcon:"ui-icon-circle-close",show:null,hide:null,autoOpen:!1,multiple:null,position:{},appendTo:null,menuWidth:null,selectedListSeparator:", ",disableInputsOnToggle:!0,groupColumns:!1},_getAppendEl:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_create:function(){var i=this.element,s=this.options;this.isMultiple=s.multiple||"undefined"!=typeof i.attr("multiple"),this.speed=e.fx.speeds._default,this._isOpen=!1,this.inputIdCounter=0,this._namespaceID=this.eventNamespace||"multiselect"+t,this.multiselectID=t++;var n=(this.button=e('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all "+s.classes).attr({title:i.attr("title"),tabIndex:i.attr("tabIndex"),id:i.attr("id")?i.attr("id")+"_ms":null}).prop("aria-haspopup",!0).insertAfter(i);this.buttonlabel=e("<span />").html(s.noneSelectedText).appendTo(n),this.menu=e("<div />").addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all "+s.classes).appendTo(this._getAppendEl()),this.header=e("<div />").addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(this.menu),this.headerLinkContainer=e("<ul />").addClass("ui-helper-reset").html(function(){if(s.header===!0){var e="";return s.showCheckAll&&(e='<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+s.checkAllText+"</span></a></li>"),s.showUncheckAll&&(e+='<li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+s.uncheckAllText+"</span></a></li>"),e}return"string"==typeof s.header?"<li>"+s.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon '+s.closeIcon+'"></span></a></li>').appendTo(this.header);(this.checkboxContainer=e("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(this.menu);this._bindEvents(),this.refresh(!0),this.isMultiple||this.menu.addClass("ui-multiselect-single"),i.hide()},_init:function(){this.options.header===!1&&this.header.hide(),this.isMultiple?this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").show():this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},_makeOption:function(t){var i=t.title?t.title:null,s=t.value,n=this.element.attr("id")||this.multiselectID,l="ui-multiselect-"+this.multiselectID+"-"+(t.id||n+"-option-"+this.inputIdCounter++),a=t.disabled,u=t.selected,h=["ui-corner-all"],o=[];this.options;a&&(o.push("ui-multiselect-disabled"),h.push("ui-state-disabled")),t.className&&o.push(t.className),u&&!this.isMultiple&&h.push("ui-state-active");var c=e("<li/>").addClass(o.join(" ")),r=e("<label/>").attr({"for":l,title:i}).addClass(h.join(" ")).appendTo(c),d=e("<input/>").attr({name:"multiselect_"+n,type:this.isMultiple?"checkbox":"radio",value:s,title:i,id:l,checked:u?"checked":null,"aria-selected":u?"true":null,disabled:a?"disabled":null,"aria-disabled":a?"true":null}).data(e(t).data()).appendTo(r),p=e("<span/>").text(e(t).text());return d.data("image-src")&&p.prepend(e("<img/>").attr({src:d.data("image-src")})),p.appendTo(r),c},_buildOptionList:function(t,i){var s=this;t.children().each(function(){var t=e(this);if("OPTGROUP"===this.tagName){var n=e("<ul/>").addClass("ui-multiselect-optgroup "+this.className).appendTo(i);s.options.groupColumns&&n.addClass("ui-multiselect-columns"),e("<a/>").text(this.getAttribute("label")).appendTo(n),s._buildOptionList(t,n)}else{s._makeOption(this).appendTo(i)}})},refresh:function(t){var i=this.element,s=(this.options,this.menu),n=(this.checkboxContainer,e("<ul/>").addClass("ui-multiselect-checkboxes ui-helper-reset"));this.inputIdCounter=0,this.options.header&&(this.isMultiple?this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").show():this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide()),this._buildOptionList(i,n),this.menu.find(".ui-multiselect-checkboxes").remove(),this.menu.append(n),this.labels=s.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this.update(!0),t||this._trigger("refresh")},update:function(t){var i,s=this.options,n=this.inputs,l=n.filter(":checked"),a=l.length;i=0===a?s.noneSelectedText:e.isFunction(s.selectedText)?s.selectedText.call(this,a,n.length,l.get()):/\d/.test(s.selectedList)&&s.selectedList>0&&a<=s.selectedList?l.map(function(){return e(this).next().text()}).get().join(s.selectedListSeparator):s.selectedText.replace("#",a).replace("#",n.length),this._setButtonValue(i),t&&(this.button[0].defaultValue=i)},_setButtonValue:function(e){this.buttonlabel.text(e)},_bindButtonEvents:function(){function t(){return i[i._isOpen?"close":"open"](),!1}var i=this,s=this.button;s.find("span").bind("click.multiselect",t),s.bind({click:t,keypress:function(e){switch(e.which){case 27:case 38:case 37:i.close();break;case 39:case 40:i.open()}},mouseenter:function(){s.hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},mouseleave:function(){e(this).removeClass("ui-state-hover")},focus:function(){s.hasClass("ui-state-disabled")||e(this).addClass("ui-state-focus")},blur:function(){e(this).removeClass("ui-state-focus")}})},_bindMenuEvents:function(){var t=this;this.menu.on("click.multiselect",".ui-multiselect-optgroup a",function(i){i.preventDefault();var s=e(this),n=s.parent().find("input:visible:not(:disabled)"),l=n.get(),a=s.text();t._trigger("beforeoptgrouptoggle",i,{inputs:l,label:a})!==!1&&(t._toggleChecked(n.filter(":checked").length!==n.length,n),t._trigger("optgrouptoggle",i,{inputs:l,label:a,checked:l.length?l[0].checked:null}))}).on("mouseenter.multiselect","label",function(){e(this).hasClass("ui-state-disabled")||(t.labels.removeClass("ui-state-hover"),e(this).addClass("ui-state-hover").find("input").focus())}).on("keydown.multiselect","label",function(i){if(82!==i.which&&!(i.which>111&&i.which<124))switch(i.preventDefault(),i.which){case 9:i.shiftKey?(t.menu.find(".ui-state-hover").removeClass("ui-state-hover"),t.header.find("li").last().find("a").focus()):t.close();break;case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(i.which,this);break;case 13:case 32:e(this).find("input")[0].click();break;case 65:i.altKey&&t.checkAll();break;case 85:i.altKey&&t.uncheckAll()}}).on("click.multiselect",'input[type="checkbox"], input[type="radio"]',function(i){var s=e(this),n=this.value,l=s.parent().find("span").text(),a=this.checked,u=t.element.find("option");return this.disabled||t._trigger("click",i,{value:n,text:l,checked:a})===!1?void i.preventDefault():(s.focus(),s.prop("aria-selected",a),u.each(function(){this.value===n?this.selected=a:t.isMultiple||(this.selected=!1)}),t.isMultiple||(t.labels.removeClass("ui-state-active"),s.closest("label").toggleClass("ui-state-active",a),t.close()),t.element.trigger("change"),void setTimeout(e.proxy(t.update,t),10))})},_bindHeaderEvents:function(){var t=this;this.header.on("click.multiselect","a",function(i){var s=e(this);s.hasClass("ui-multiselect-close")?t.close():s.hasClass("ui-multiselect-all")?t.checkAll():s.hasClass("ui-multiselect-none")&&t.uncheckAll(),i.preventDefault()}).on("keydown.multiselect","a",function(i){switch(i.which){case 27:t.close();break;case 9:var s=e(i.target);(!i.shiftKey||s.parent().prev().length||t.header.find(".ui-multiselect-filter").length)&&(s.parent().next().length||t.labels.length||i.shiftKey)||(t.close(),i.preventDefault())}})},_bindEvents:function(){var t=this;this._bindButtonEvents(),this._bindMenuEvents(),this._bindHeaderEvents(),i.bind("mousedown."+t._namespaceID,function(i){var s=i.target;!t._isOpen||s===t.button[0]||s===t.menu[0]||e.contains(t.menu[0],s)||e.contains(t.button[0],s)||t.close()}),e(this.element[0].form).bind("reset."+this._namespaceID,function(){setTimeout(e.proxy(t.refresh,t),10)})},_getMinWidth:function(){var e=this.options.minWidth,t=0;switch(typeof e){case"number":t=e;break;case"string":var i=e[e.length-1];t=e.match(/\d+/),t="%"===i?this.element.parent().outerWidth()*(t/100):parseInt(e,10)}return t},_setButtonWidth:function(){var e=this.element.outerWidth(),t=this._getMinWidth();t>e&&(e=t),this.button.outerWidth(e)},_setMenuWidth:function(){var e=this.menu,t=this.button.outerWidth()<=0?this._getMinWidth():this.button.outerWidth();e.outerWidth(this.options.menuWidth||t)},_setMenuHeight:function(){var t=this.menu.children(".ui-multiselect-header:visible").outerHeight(!0),i=0;this.menu.find(".ui-multiselect-checkboxes li, .ui-multiselect-checkboxes a").each(function(t,s){i+=e(s).outerHeight(!0)}),i>this.options.height?(this.menu.children(".ui-multiselect-checkboxes").css("overflow","auto"),i=this.options.height):this.menu.children(".ui-multiselect-checkboxes").css("overflow","hidden"),this.menu.children(".ui-multiselect-checkboxes").height(i),this.menu.height(i+t)},_resizeMenu:function(){this._setMenuWidth(),this._setMenuHeight()},_traverse:function(t,i){var s=e(i),n=38===t||37===t,l=s.parent()[n?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup):visible").first();if(l.length||(l=s.parents(".ui-multiselect-optgroup")[n?"prev":"next"]()),l.length)l.find("label:visible")[n?"last":"first"]().trigger("mouseover");else{var a=this.menu.find("ul").last();this.menu.find("label:visible")[n?"last":"first"]().trigger("mouseover"),a.scrollTop(n?a.height():0)}},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(e,t){var i=t&&t.length?t:this.inputs,s=this;i.each(this._toggleState("checked",e)),i.eq(0).focus(),this.update();var n={};i.each(function(){n[this.value]=!0}),this.element.selectedIndex=-1,this.element.find("option").each(function(){!this.disabled&&n[this.value]&&s._toggleState("selected",e).call(this)}),i.length&&this.element.trigger("change")},_toggleDisabled:function(e){if(this.button.prop({disabled:e,"aria-disabled":e})[e?"addClass":"removeClass"]("ui-state-disabled"),this.options.disableInputsOnToggle){var t=this.menu.find(".ui-multiselect-checkboxes").get(0),i=[],s="ech-multiselect-disabled",n=0;if(e)for(i=t.querySelectorAll("input:enabled"),n=0;n<i.length;n++)i[n].setAttribute(s,!0),i[n].setAttribute("disabled","disabled"),i[n].setAttribute("aria-disabled","disabled"),i[n].parentNode.className=i[n].parentNode.className+" ui-state-disabled";else for(i=t.querySelectorAll("input:disabled"),n=0;n<i.length;n++)i[n].hasAttribute(s)&&(i[n].removeAttribute(s),i[n].removeAttribute("disabled"),i[n].removeAttribute("aria-disabled"),i[n].parentNode.className=i[n].parentNode.className.replace(" ui-state-disabled",""))}this.element.prop({disabled:e,"aria-disabled":e})},open:function(){var t=this,i=this.button,s=this.menu,n=this.speed,l=this.options,a=[];if(this._trigger("beforeopen")!==!1&&!i.hasClass("ui-state-disabled")&&!this._isOpen){var u=s.find(".ui-multiselect-checkboxes"),h=l.show;e.isArray(l.show)&&(h=l.show[0],n=l.show[1]||t.speed),h&&(a=[h,n]),u.scrollTop(0),e.fn.show.apply(s,a),this._resizeMenu(),this.position();var o=this.header.find(".ui-multiselect-filter");o.length?o.first().find("input").trigger("focus"):this.labels.length?this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"):this.header.find("a").first().trigger("focus"),i.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==!1){var t=this.options,i=t.hide,s=this.speed,n=[];e.isArray(t.hide)&&(i=t.hide[0],s=t.hide[1]||this.speed),i&&(n=[i,s]),e.fn.hide.apply(this.menu,n),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close"),this.button.trigger("focus")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this.isMultiple||(this.element[0].selectedIndex=-1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},getUnchecked:function(){return this.menu.find("input").not(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),i.unbind(this._namespaceID),e(this.element[0].form).unbind(this._namespaceID),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},getMenu:function(){return this.menu},getLabels:function(){return this.labels},addOption:function(t,i,s){var n=e("<option/>").attr(t).text(i),l=n.get(0);s?(this.element.children("OPTGROUP").filter(function(){return e(this).prop("label")===s}).append(n),this.menu.find(".ui-multiselect-optgroup").filter(function(){return e(this).find("a").text()===s}).append(this._makeOption(l))):(this.element.append(n),this.menu.find(".ui-multiselect-checkboxes").append(this._makeOption(l))),this.labels=this.menu.find("label"),this.inputs=this.labels.children("input")},removeOption:function(e){e&&(this.element.find("option[value="+e+"]").remove(),this.labels.find("input[value="+e+"]").parents("li").remove(),this.labels=this.menu.find("label"),this.inputs=this.labels.children("input"))},position:function(){var t={my:"top",at:"bottom",of:this.button};e.isEmptyObject(this.options.position)||(t.my=this.options.position.my||t.my,t.at=this.options.position.at||t.at,t.of=this.options.position.of||t.of),e.ui&&e.ui.position?this.menu.position(t):(t=this.button.position(),t.top+=this.button.outerHeight(!1),this.menu.offset(t))},_setOption:function(t,i){var s=this.menu;switch(t){case"header":"boolean"==typeof i?this.header[i?"show":"hide"]():"string"==typeof i&&(this.headerLinkContainer.children("li:not(:last-child)").remove(),this.headerLinkContainer.prepend("<li>"+i+"</li>"));break;case"checkAllText":s.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":s.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":this.options[t]=i,this._setMenuHeight();break;case"minWidth":case"menuWidth":this.options[t]=i,this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=i,this.update();break;case"classes":s.add(this.button).removeClass(this.options.classes).addClass(i);break;case"multiple":this.isMultiple!=i&&(s.toggleClass("ui-multiselect-multiple",i),s.toggleClass("ui-multiselect-single",!i),i?this.element[0].setAttribute("multiple","multiple"):this.element[0].removeAttribute("multiple"),this.isMultiple=i,this.uncheckAll(),this.refresh());break;case"position":this.position();break;case"selectedListSeparator":this.options[t]=i,this.update(!0)}e.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);
